<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Devastator111: Weather</title>
    <nav>
        <a href=weather.html>Weather</a>
    </nav>
</head>
<body>
    <p>Make something amazing with Tynker</p>
    <script>
        
        document.cookie = "test1=Hello; SameSite=None; Secure";
        document.cookie = "test2="+Date.now()+"; SameSite=None; Secure";
        //document.cookie = "test2=Hello; expires=Thu, 01 Jan 1970 00:00:00 UTC;";  
        var allsongs = [{title:"Rey's Theme",artist:"John Williams",length:"30",link:"https://github.com/devastator111/testRepo/raw/refs/heads/main/example.mp3"},
                      {title:"Flagpole Sitta",artist:"Harvey Danger",length:"",link:""}];
        var findTitle;
        //expireCookies();
        console.log(getCookie('songTime'))
        if(getCookie("songTime")){
            playSong(getCookie("songTitle"),getCookie("songTime"));
        }else{
            playSong("Rey's Theme",0);
        }
        
        function getCookie(name){
            if(document.cookie.includes(name)){
            return document.cookie
            .split("; ")
            .find((row) => row.startsWith(name+"="))
            ?.split("=")[1];
            }else{
                return false;
            }
        };
        
        function expireCookies() {
            document.cookie = "currentTime=--; SameSite=None; expires=Thu 01 Jan 1970 00:00:00 UTC; Secure ";
            document.cookie = "songTime=--; SameSite=None; expires=Thu 01 Jan 1970 00:00:00 UTC; Secure ";
            document.cookie = "startTime=--; SameSite=None; expires=Thu 01 Jan 1970 00:00:00 UTC; Secure";
            document.cookie = "totalTime=--; SameSite=None; expires=Thu 01 Jan 1970 00:00:00 UTC; Secure";

        }
        function showCookieValue() {
            const output = document.getElementById("cookie-value");
            output.textContent = getCookie('currentTime');
        };

        function clearOutputCookieValue() {
            const output = document.getElementById("cookie-value");
            output.textContent = "";
        };
        var saveTime = function(){
            document.cookie = "currentTime="+Date.now()+"; SameSite=None; expires=None; Secure"
            const output = document.getElementById("cookie-value");
            output.textContent = getCookie('currentTime');
            document.cookie = "songTime="+document.getElementById("song").currentTime+"; SameSite=None; Secure";
        };
        //saveTime();
        setInterval(saveTime,100);
        
      function findSong(element){
        if(element.title===findTitle){
          return true;
        }
      };
      function playSong(searchTitle,time){
        findTitle = searchTitle;
        text = document.createTextNode("he");
        newAudio = document.createElement("AUDIO");
        newAudio.src=allsongs[allsongs.findIndex(findSong)].link;
        newAudio.currentTime = time;
        newAudio.controls = true;
        newAudio.autoplay = false;
        newAudio.setAttribute("id","song")
        document.querySelector("body").appendChild(newAudio);
        document.cookie = "startTime="+Date.now()-newAudio.currentTime*1000+"; SameSite=None; Secure";
        
        document.cookie = "songTitle="+searchTitle+"; SameSite=None; Secure";
      };
      //playSong("Rey's Theme",12);




    </script>  
    <button onclick="showCookieValue()">Show cookie value</button>
    <button onclick="clearOutputCookieValue()">Clear</button>
    <div>
        <code id="cookie-value"></code>
    </div>
</body>
</html>
